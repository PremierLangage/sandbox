{
    "__files": {
        "start.py":"#!/usr/bin/env python3\n# coding: utf-8\n\nimport sys, json, jsonpickle\n\nimport platon\n\ndef makepayload(dic):\n    \"\"\"\n    Objectif réduire la taille du dict retourné au front.\n    \"\"\"\n    d={}\n    for key in dic.keys():\n        # pas de code \n        if key.endswith(\".py\"): \n            continue\n        # pas les settings \n        if key==\"settings\":\n            continue\n        # pas les variables \"_privées\" \n        if key.startswith(\"_\"):\n            continue\n        d[key]= dic[key]\n    return d\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 4:\n        msg = (\"Sandbox did not call starter properly:\\n\"\n               +\"Usage: python3 start.py [input_json] [output_json] [result_json]\")\n        print(msg, file=sys.stderr)\n        sys.exit(1)\n    input_json = sys.argv[1]\n    output_json = sys.argv[2]\n    result_json = sys.argv[3]\n    \n    with open(input_json, \"r\") as f:\n        dic = json.load(f)\n\n    with open(\"settings.json\",\"w+\") as settings:\n        settings.write(jsonpickle.encode(dic[\"settings\"], unpicklable=False))\n    \n    if 'start' in dic:\n        exec(dic['start'], dic)\n    else:\n        print((\"No default start script. Please define a start script.\"),\n              file = sys.stderr)\n        sys.exit(1)\n    \n    ploaddic = makepayload(dic)\n    with open(result_json,\"w+\") as pload:\n        pload.write(jsonpickle.encode(ploaddic, unpicklable=False))\n\n    with open(output_json, \"w+\") as f:\n        f.write(jsonpickle.encode(dic, unpicklable=False))\n    \n    sys.exit(0)\n",
        "platon.py":"import os\nimport subprocess\n\ndef build(plid, params):\n    \"\"\"\n    création de l'environement\n    \"\"\"\n    os.chdir(str(plid))\n    command = \"python3 builder.py pl.json processed.json 2> stderr.log\"\n    subprocess.call([command], shell=True)\n    path = os.getcwd()\n    print(os.path.basename(path))\n    os.chdir(\"..\")\n",
        "next.py": "#!/usr/bin/env python3\n# coding: utf-8\n\nimport sys, json, jsonpickle\n\nimport platon\n\ndef makepayload(dic):\n    \"\"\"\n    Objectif réduire la taille du dict retourné au front.\n    \"\"\"\n    d={}\n    for key in dic.keys():\n        # pas de code \n        if key.endswith(\".py\"): \n            continue\n        # pas les settings \n        if key==\"settings\":\n            continue\n        # pas les variables \"_privées\" \n        if key.startswith(\"_\"):\n            continue\n        d[key]= dic[key]\n    return d\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 4:\n        msg = (\"Sandbox did not call nexter properly:\\n\"\n               +\"Usage: python3 next.py [input_json] [output_json] [result_json]\")\n        print(msg, file=sys.stderr)\n        sys.exit(1)\n    input_json = sys.argv[1]\n    output_json = sys.argv[2]\n    result_json = sys.argv[3]\n\n    \n    with open(input_json, \"r\") as f:\n        dic = json.load(f)\n        copy_dic = {k:v for k,v in dic.items()}\n    \n    if 'next' in dic:\n        exec(dic['next'], copy_dic)\n    else:\n        print((\"No default start script. Please define a next script.\"),\n              file = sys.stderr)\n        sys.exit(1)\n    \n    ploaddic = makepayload(dic)\n    with open(result_json,\"w+\") as pload:\n        pload.write(jsonpickle.encode(ploaddic, unpicklable=False))\n\n    with open(output_json, \"w+\") as f:\n        f.write(jsonpickle.encode(dic, unpicklable=False))\n\n    for key in copy_dic.keys():\n        if key in dic.keys():\n            dic[key] = copy_dic[key]\n\n    with open(input_json, \"w+\") as f:\n        f.write(json.dumps(dic))\n    \n    sys.exit(0)"
    },
    "lst_exos": [
        2
    ],
    "settings": {
        "nbtry":0,
        "reroll":"True",
        "syntactic":"True",
        "feedback":"False",
        "evaluation":"False",
        "validation":"True"
    },
    "start":"import os\nimport platon\nplaton.build(lst_exos[current], {})\n",
    "start2":"import os\nimport platon\nfor i in lst_exos:\n    platon.build(i, {})\n",
    "next":"import platon\ncurrent = current+1\nplaton.build(lst_exos[current], {})\n",
    "end":""
}

